/**
 * 微信小程序JavaScriptSDK
 * 
 * @version 1.2
 * @date 2019-03-06
 */

var ERROR_CONF={KEY_ERR:311,KEY_ERR_MSG:"key格式错误",PARAM_ERR:310,PARAM_ERR_MSG:"请求参数信息有误",SYSTEM_ERR:600,SYSTEM_ERR_MSG:"系统错误",WX_ERR_CODE:1000,WX_OK_CODE:200};var BASE_URL="https://apis.map.qq.com/ws/";var URL_SEARCH=BASE_URL+"place/v1/search";var URL_SUGGESTION=BASE_URL+"place/v1/suggestion";var URL_GET_GEOCODER=BASE_URL+"geocoder/v1/";var URL_CITY_LIST=BASE_URL+"district/v1/list";var URL_AREA_LIST=BASE_URL+"district/v1/getchildren";var URL_DISTANCE=BASE_URL+"distance/v1/";var URL_DIRECTION=BASE_URL+"direction/v1/";var MODE={driving:"driving",transit:"transit"};var EARTH_RADIUS=6378136.49;var Utils={safeAdd(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&65535)},bitRotateLeft(num,cnt){return(num<<cnt)|(num>>>(32-cnt))},md5cmn(q,a,b,x,s,t){return this.safeAdd(this.bitRotateLeft(this.safeAdd(this.safeAdd(a,q),this.safeAdd(x,t)),s),b)},md5ff(a,b,c,d,x,s,t){return this.md5cmn((b&c)|(~b&d),a,b,x,s,t)},md5gg(a,b,c,d,x,s,t){return this.md5cmn((b&d)|(c&~d),a,b,x,s,t)},md5hh(a,b,c,d,x,s,t){return this.md5cmn(b^c^d,a,b,x,s,t)},md5ii(a,b,c,d,x,s,t){return this.md5cmn(c^(b|~d),a,b,x,s,t)}};function QQMapWX(options){if(!options.key){throw Error("key值不能为空")}this.key=options.key}QQMapWX.prototype.search=function(options){var that=this;options=options||{};Utils.polyfillParam(options);if(!Utils.checkKeyword(options)){return}var requestParam={keyword:options.keyword,boundary:"nearby("+options.location.latitude+","+options.location.longitude+","+options.radius+")",page_size:options.page_size||10,page_index:options.page_index||1,orderby:options.orderby||"_distance",key:that.key};wx.request({url:URL_SEARCH,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function(response){var data=response.data;if(data.status===0){if(options.success){options.success({data:data.data,message:data.message})}}else{if(options.fail){options.fail({status:data.status,message:data.message})}}},fail:function(response){if(options.fail){options.fail(response)}}})};QQMapWX.prototype.reverseGeocoder=function(options){var that=this;options=options||{};Utils.polyfillParam(options);var requestParam={coord_type:options.coord_type||5,get_poi:options.get_poi||0,poi_options:options.poi_options||"radius=3000;page_size=20",key:that.key};if(options.location){requestParam.location=options.location.latitude+","+options.location.longitude}else if(options.address_reference){requestParam.address_reference=options.address_reference}wx.request({url:URL_GET_GEOCODER,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function(response){var data=response.data;if(data.status===0){if(options.success){options.success(data)}}else{if(options.fail){options.fail({status:data.status,message:data.message})}}},fail:function(response){if(options.fail){options.fail(response)}}})};QQMapWX.prototype.geocoder=function(options){var that=this;options=options||{};Utils.polyfillParam(options);if(Utils.checkParamKeyEmpty(options,"address")){return}var requestParam={address:options.address,key:that.key};wx.request({url:URL_GET_GEOCODER,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function(response){var data=response.data;if(data.status===0){if(options.success){options.success(data)}}else{if(options.fail){options.fail({status:data.status,message:data.message})}}},fail:function(response){if(options.fail){options.fail(response)}}})};QQMapWX.prototype.getCityList=function(options){var that=this;options=options||{};Utils.polyfillParam(options);var requestParam={key:that.key};wx.request({url:URL_CITY_LIST,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function(response){var data=response.data;if(data.status===0){if(options.success){options.success(data)}}else{if(options.fail){options.fail({status:data.status,message:data.message})}}},fail:function(response){if(options.fail){options.fail(response)}}})};QQMapWX.prototype.getDistrictByCityId=function(options){var that=this;options=options||{};Utils.polyfillParam(options);if(Utils.checkParamKeyEmpty(options,"id")){return}var requestParam={id:options.id||'',key:that.key};wx.request({url:URL_AREA_LIST,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function(response){var data=response.data;if(data.status===0){if(options.success){options.success(data)}}else{if(options.fail){options.fail({status:data.status,message:data.message})}}},fail:function(response){if(options.fail){options.fail(response)}}})};QQMapWX.prototype.calculateDistance=function(options){var that=this;options=options||{};Utils.polyfillParam(options);if(Utils.checkParamKeyEmpty(options,"to")){return}var requestParam={mode:options.mode||'walking',to:options.to,key:that.key};var locationsuccess=function(result){requestParam.from=result.latitude+","+result.longitude;wx.request({url:URL_DISTANCE,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function(response){var data=response.data;if(data.status===0){if(options.success){options.success({calculations:data.result.elements})}}else{if(options.fail){options.fail({status:data.status,message:data.message})}}},fail:function(response){if(options.fail){options.fail(response)}}})};if(options.from){if(typeof options.from=="string"){requestParam.from=options.from}else{requestParam.from=options.from.latitude+","+options.from.longitude}wx.request({url:URL_DISTANCE,data:requestParam,header:{"content-type":"application/json"},method:"GET",success:function(response){var data=response.data;if(data.status===0){if(options.success){options.success(data)}}else{if(options.fail){options.fail({status:data.status,message:data.message})}}},fail:function(response){if(options.fail){options.fail(response)}}})}else{wx.getLocation({success:locationsuccess,fail:function(response){if(options.fail){options.fail(response)}}})}};module.exports = {
  QQMapWX: QQMapWX
};